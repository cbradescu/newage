{% extends 'OroUIBundle:actions:update.html.twig' %}

{% oro_title_set({params : {"%entity.name%": entity.id, "%entityName%": 'cb.newage.reservation.entity_label'|trans }}) %}

{% set entityId = entity.id %}
{% set formAction = entityId ? path('cb_newage_reservation_update', { 'id': entityId}) : path('cb_newage_reservation_create', {'id': entity.offer.id}) %}

{% block navButtons %}
    {% set html = UI.saveAndCloseButton() %}
    {% if resource_granted('cb_newage_reservation_update') %}
        {% set html = html ~ UI.saveAndStayButton() %}
    {% endif %}
    {{ UI.dropdownSaveButton({'html': html}) }}
    {{ UI.cancelButton(path('cb_newage_reservation_index')) }}
{% endblock navButtons %}

{% block pageHeader %}
    {% if entityId %}
        {% set breadcrumbs = {
        'entity': entity,
        'indexPath': path('cb_newage_reservation_index'),
        'indexLabel': 'cb.newage.reservation.entity_plural_label'|trans,
        'entityTitle': entity.offer.name
        } %}
        {{ parent() }}
    {% else %}
        {% set title = 'oro.ui.create_entity'|trans({'%entityName%': 'cb.newage.reservation.entity_label'|trans}) %}
        {% include 'OroUIBundle::page_title_block.html.twig' with { title: title } %}
    {% endif %}
{% endblock pageHeader %}

{% block content_data %}
    {% set id = 'reservation-form' %}

    {%- set offerInformation -%}
        <div class="row-fluid form-horizontal">
            <div class="responsive-block">
                {{ UI.renderProperty('cb.newage.offer.name.label'|trans, entity.offer.name) }}
                {{ UI.renderProperty('cb.newage.campaign.start.label'|trans, entity.offer.start|oro_format_date) }}
                {{ UI.renderProperty('cb.newage.campaign.end.label'|trans, entity.offer.end|oro_format_date) }}

                {%- set campaignData -%}
                    {%- if entity.offer.campaign -%}
                        <a href="{{ path('cb_newage_campaign_view', {'id': entity.offer.campaign.id}) }}">
                            {{ entity.offer.campaign }}
                        </a>
                    {%- endif -%}
                {%- endset -%}

                {{ UI.renderHtmlProperty('cb.newage.campaign.entity_label'|trans, campaignData) }}

            </div>
            <div style="display:none">
                {{ form_row(form.offer) }}
            </div>

        </div>
    {%- endset -%}

    {% set dataBlocks = [{
    'title': 'cb.newage.offer.entity_label'|trans ~ ' #' ~ entity.offer.id,
        'subblocks': [
            {
                'data' : [offerInformation]
            }
        ]
    },
    {
        'title': 'Reserved Panel Views',
        'class': 'active',
        'subblocks': [
            {
                'data': [
                    form_row(form.reservedPanelViews),

                    form.owner is defined ? form_row(form.owner) : '',
                ]
            }
        ]
    }] %}

    {% set data = {
    'formErrors': form_errors(form)? form_errors(form) : null,
    'dataBlocks': dataBlocks,
    } %}
    {{ parent() }}
{% endblock content_data %}