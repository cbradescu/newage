datagrid:
    base-panel-grid:
        source:
            type: orm
            acl_resource: cb_newage_panel_view
            query:
                select:
                    - panel.id
                    - panel.name
                    - stype.name as support
                    - ltype.name as lighting
                    - panel.dimensions
                    - c.name as city
                from:
                    - { table: %cb_newage_panel.entity.class%, alias: panel }
                join:
                    left:
                        -
                            join: panel.supportType
                            alias: stype
                        -
                            join: panel.lightingType
                            alias: ltype
                        - { join: panel.addresses, alias: addr, conditionType: WITH, condition: 'addr.primary = true' }
                        -
                            join: addr.city
                            alias: c
        columns:
            id:
                label:        cb.newage.panel.id.label
            name:
                label:        cb.newage.panel.name.label
            support:
                label:        cb.newage.supporttype.entity_label
            lighting:
                label:        cb.newage.lightingtype.entity_label
            dimensions:
                label:        cb.newage.panel.dimensions.label
            city:
                label:        oro.address.city.label
        sorters:
            columns:
                id:
                    data_name: panel.id
                name:
                    data_name: panel.name
                support:
                    data_name: stype.name
                lighting:
                    data_name: ltype.name
                city:
                    data_name: c.name
            default:
                city:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
        filters:
            columns:
                name:
                    type: string
                    data_name: panel.name
                    enabled: true
                support:
                    type: entity
                    data_name: panel.supportType
                    options:
                        field_options:
                            class: CBNewAgeBundle:SupportType
                lighting:
                    type: entity
                    data_name: panel.lightingType
                    options:
                        field_options:
                            class: CBNewAgeBundle:LightingType
                city:
                    type: choice-tree
                    data_name: addr.city
                    options:
                        lazy: "@cb_city.provider.filter.city_choice_tree->shouldBeLazy"
                        data: "@?cb_city.provider.filter.city_choice_tree->getList"
                    enabled: true
        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_panel_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_panel_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_panel_api_delete_panel
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_panel_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_panel_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_panel_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    panel-grid:
        extends: base-panel-grid

    base-panel_view-grid:
        source:
            type: orm
            acl_resource: cb_newage_panel_view_view
            query:
                select:
                    - panelView.id
                    - panelView.name
                    - panel.name as panelName
                from:
                    - { table: %cb_newage_panel_view.entity.class%, alias: panelView }
                join:
                    left:
                        -
                            join: panelView.panel
                            alias: panel
        columns:
            name:
                label:        cb.newage.panelview.name.label
        sorters:
            columns:
                name:
                    data_name: panelView.name
        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_panel_view_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_panel_view_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_panel_view_api_delete_panel_view
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_panel_view_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_panel_view_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_panel_view_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    panel_view-grid:
        extends: base-panel_view-grid
        columns:
            panelName:
                label:        cb.newage.panel.entity_label
        sorters:
            columns:
                panelName:
                    data_name: panel.name
        filters:
            columns:
                panelName:
                    type: entity
                    data_name: panelView.panel
                    options:
                        field_options:
                            class: CBNewAgeBundle:Panel
    panel-panel_views-grid:
        extends: base-panel_view-grid
        source:
            query:
                where:
                    and:
                        - ( panel.id = :panel_id)
            bind_parameters:
                - panel_id

    base-campaign-grid:
        source:
            type: orm
            acl_resource: cb_newage_campaign_view
            query:
                select:
                    - campaign.id
                    - campaign.title
                from:
                    - { table: %cb_newage_campaign.entity.class%, alias: campaign }
        columns:
            id:
                label: cb.newage.campaign.id.label
            title:
                label: cb.newage.campaign.title.label

        filters:
            columns:
                title:
                    type: string
                    data_name: campaign.title

        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_campaign_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_campaign_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_campaign_api_delete_campaign
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_campaign_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_campaign_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_campaign_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    campaign-grid:
        extends: base-campaign-grid

    base-campaign-to-panel-view-update-grid:
        source:
            type: orm
            acl_resource: cb_newage_panel_view_view
            query:
                select:
                    - panelView.id
                    - panelView.name
                    - panel.name as panelName
                    - panel.dimensions as panelDimensions
                from:
                    - { table: %cb_newage_panel_view.entity.class%, alias: panelView }
                join:
                    left:
                        -
                            join: panelView.panel
                            alias: panel
            bind_parameters:
                - campaign
        sorters:
            columns:
                name:
                    data_name: panelView.name

    base-support_type-grid:
        source:
            type: orm
            acl_resource: cb_newage_support_type_view
            query:
                select:
                    - supportType.id
                    - supportType.name
                from:
                    - { table: %cb_newage_support_type.entity.class%, alias: supportType }
        columns:
            id:
                label:        cb.newage.supporttype.id.label
            name:
                label:        cb.newage.supporttype.name.label

        sorters:
            columns:
                id:
                    data_name: supportType.id
                name:
                    data_name: supportType.name
            default:
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        filters:
            columns:
                name:
                    type: string
                    data_name: supportType.name
                    enabled: true

        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_support_type_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_support_type_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_support_type_api_delete_support_type
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_support_type_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_support_type_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_support_type_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    support_type-grid:
        extends: base-support_type-grid

    base-lighting_type-grid:
        source:
            type: orm
            acl_resource: cb_newage_lighting_type_view
            query:
                select:
                    - lightingType.id
                    - lightingType.name
                from:
                    - { table: %cb_newage_lighting_type.entity.class%, alias: lightingType }
        columns:
            id:
                label:        cb.newage.lightingtype.id.label
            name:
                label:        cb.newage.lightingtype.name.label

        sorters:
            columns:
                id:
                    data_name: lightingType.id
                name:
                    data_name: lightingType.name
            default:
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        filters:
            columns:
                name:
                    type: string
                    data_name: lightingType.name
                    enabled: true

        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_lighting_type_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_lighting_type_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_lighting_type_api_delete_lighting_type
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_lighting_type_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_lighting_type_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_lighting_type_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    lighting_type-grid:
        extends: base-lighting_type-grid

    base-city-grid:
        source:
            type: orm
            acl_resource: cb_newage_city_view
            query:
                select:
                    - city.id
                    - city.name
                from:
                    - { table: %cb_newage_city.entity.class%, alias: city }
        columns:
            name:
                label:        cb.newage.city.name.label

        sorters:
            columns:
                name:
                    data_name: city.name

            default:
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        filters:
            columns:

        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_city_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_city_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_city_api_delete_city
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_city_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_city_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_city_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    city-grid:
        extends: base-city-grid
        filters:
            columns:

    base-offer-grid:
        source:
            type: orm
            acl_resource: cb_newage_offer_view
            query:
                select:
                    - offer.id
                    - offer.name
                    - c.title as campaign
                    - offer.start
                    - offer.end
                    - COUNT(pv.id) as panelViewsNo
                from:
                    - { table: %cb_newage_offer.entity.class%, alias: offer }
                join:
                    left:
                        -
                            join: offer.campaign
                            alias: c
                        -
                            join: offer.panelViews
                            alias: pv

        columns:
            id:
                label:  cb.newage.offer.id.label
            name:
                label:  cb.newage.offer.name.label
            campaign:
                label:  cb.newage.campaign.entity_label
            start:
                label: cb.newage.offer.start.label
                frontend_type: date
            end:
                label: cb.newage.offer.end.label
                frontend_type: date
            panelViewsNo:
                label:  cb.newage.offer.panel_views_no.label
        sorters:
            columns:
                id:
                    data_name: offer.id
                name:
                    data_name: offer.name
                campaign:
                    data_name: c.title

            default:
                id:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_DESC'

        filters:
            columns:
                name:
                    type: string
                    data_name: offer.name
                campaign:
                    type: entity
                    data_name: offer.campaign
                    options:
                        field_options:
                            class: CBNewAgeBundle:Campaign
                start:
                    type:      date
                    data_name: offer.start
                end:
                    type:      date
                    data_name: offer.end

        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_offer_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_offer_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_offer_api_delete_offer
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_offer_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_offer_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_offer_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    offer-grid:
        extends: base-offer-grid

    free-panel_view-grid:
        source:
            type: orm
            entity: CBNewAgeBundle:PanelView # The name of your entity
            repository_method: getFreePanelViewsQueryBuilder # The function name for query builder
            bind_parameters:
                - offer
                - start
                - end

        columns:
            hasContact:
                label:   orocrm.account.assigned.label
                editable: true
                frontend_type: boolean
            url:
                label:        cb.newage.panelview.url.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/photo.html.twig
            panel:
                label:        cb.newage.panel.entity_label
            name:
                label:        cb.newage.panelview.name.label
            support:
                label:        cb.newage.supporttype.entity_label
            lighting:
                label:        cb.newage.lightingtype.entity_label
            city:
                label:        oro.address.city.label
        sorters:
            columns:
                panel:
                    data_name: p.name
                name:
                    data_name: pv.name
            default:
                panel: '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        filters:
            columns:
                hasContact:
                    data_name: hasContact
                    type:      boolean
                support:
                    type: choice-tree
                    data_name: p.supportType
                    options:
                        lazy: "@cb_support.provider.filter.support_choice_tree->shouldBeLazy"
                        data: "@?cb_support.provider.filter.support_choice_tree->getList"
                    enabled: true
                lighting:
                    type: choice-tree
                    data_name: p.lightingType
                    options:
                        lazy: "@cb_lighting.provider.filter.lighting_choice_tree->shouldBeLazy"
                        data: "@?cb_lighting.provider.filter.lighting_choice_tree->getList"
                    enabled: true
                city:
                    type: choice-tree
                    data_name: a.city
                    options:
                        lazy: "@cb_city.provider.filter.city_choice_tree->shouldBeLazy"
                        data: "@?cb_city.provider.filter.city_choice_tree->getList"
                    enabled: true

        properties:
            id: ~
        action_configuration:
            delete: false
        options:
            entityHint: panelView
            mass_actions:
                delete:
                    enabled: false
            routerEnabled: false
            rowSelection:
                dataField: id
                columnName: hasContact
                selectors:
                    included: '#appendPanelViews'
                    excluded: '#removePanelViews'

    selected-panel_view-grid:
        source:
            type: orm
            acl_resource: cb_newage_panel_view_view
            query:
                select:
                    - pv.id
                    - pv.name
                    - pv.url as panelViewUrl
                    - p.name as panel
                    - p.dimensions
                    - st.name as support
                    - lt.name as lighting
                    - ct.name as city
                    - CONCAT(addr.street,  CONCAT(' ', addr.street2)) as address
                    - >
                        MAX(CASE WHEN (ev.id IS NULL) THEN
                            0
                          ELSE
                            ev.status
                          END) as available
                from:
                    - { table: %cb_newage_panel_view.entity.class%, alias: pv }
                join:
                    left:
                        -
                            join: pv.panel
                            alias: p
                        -
                            join: p.supportType
                            alias: st
                        -
                            join: p.lightingType
                            alias: lt
                        - { join: p.addresses, alias: addr, conditionType: WITH, condition: 'addr.primary = true' }
                        -
                            join: addr.city
                            alias: ct
                        -
                            join: pv.offers
                            alias: o
                        -
                            join: pv.events
                            alias: ev
                            conditionType: WITH
                            condition: (ev.start >= o.start AND ev.start <= o.end) OR (ev.end >= o.start AND ev.end <= o.end) OR (ev.start >= o.start AND ev.end <= o.end) OR (ev.start <= o.start AND ev.end >= o.end)
                where:
                    and:
                        - :offer MEMBER OF pv.offers
            bind_parameters:
                - offer

        columns:
            available:
                label:        cb.newage.reservation.datagrid.status.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/available.html.twig
            panelViewUrl:
                label:        cb.newage.panelview.url.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/url.html.twig
            city:
                label:        oro.address.city.label
            address:
                label:        cb.newage.panel.address.label
            panel:
                label:        cb.newage.panel.entity_label
            support:
                label:        cb.newage.supporttype.entity_label
            dimensions:
                label:        cb.newage.panel.dimensions.label
            lighting:
                label:        cb.newage.lightingtype.entity_label
            name:
                label:        cb.newage.panelview.name.label

        sorters:
            columns:
                panel:
                    data_name: p.name
                name:
                    data_name: pv.name
            default:
                panel: '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        properties:
            id: ~

        filters:
            columns:

        action_configuration:
            delete: false
        options:
            export: true
            mass_actions:
                delete:
                    enabled: false

    select-panel_view-grid:
        extends: selected-panel_view-grid
        mass_actions:
            reserve:
                type: reserve
                entity_name: %cb_newage_panel_view.entity.class%
                data_identifier: pv.id
                label: cb.newage.reservation.datagrid.action.reserve
                icon: random

    base-reservation-grid:
        source:
            type: orm
            acl_resource: cb_newage_reservation_view
            query:
                select:
                    - reservation.id
                    - o.name as name
                from:
                    - { table: %cb_newage_reservation.entity.class%, alias: reservation }
                join:
                    left:
                        -
                            join: reservation.offer
                            alias: o
        columns:
            name:
                label:        cb.newage.offer.name.label
        sorters:
            columns:

            default:

        filters:
            columns:

        properties:
            id: ~
            view_link:
                type:         url
                route:        cb_newage_reservation_view
                params:       [ id ]
            update_link:
                type:         url
                route:        cb_newage_reservation_update
                params:       [ id ]
            delete_link:
                type:         url
                route:        cb_newage_reservation_api_delete_reservation
                params:       [ id ]
        actions:
            view:
                type:         navigate
                acl_resource: cb_newage_reservation_view
                label:        oro.grid.action.view
                icon:         eye-open
                link:         view_link
                rowAction:    true
            update:
                type:         navigate
                acl_resource: cb_newage_reservation_update
                label:        oro.grid.action.update
                icon:         edit
                link:         update_link
            delete:
                type:         delete
                acl_resource: cb_newage_reservation_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
    reservation-grid:
        extends: base-reservation-grid
        filters:
            columns:

    reservation-panel_view-grid:
        source:
            type: orm
            entity: CBNewAgeBundle:PanelView # The name of your entity
            repository_method: getReservedPanelViewsWithStatusQueryBuilder # The function name for query builder
            bind_parameters:
                - reservation
            acl_resource: cb_newage_panel_view_view
        columns:
            available:
                label:        cb.newage.reservation.datagrid.status.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/available.html.twig
            panelViewUrl:
                label:        cb.newage.panelview.url.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/url.html.twig
            city:
                label:        oro.address.city.label
            address:
                label:        cb.newage.panel.address.label
            panel:
                label:        cb.newage.panel.entity_label
            support:
                label:        cb.newage.supporttype.entity_label
            dimensions:
                label:        cb.newage.panel.dimensions.label
            lighting:
                label:        cb.newage.lightingtype.entity_label
            name:
                label:        cb.newage.panelview.name.label

        sorters:
            columns:
                panel:
                    data_name: p.name
                name:
                    data_name: pv.name
            default:
                panel: '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
        properties:
            id: ~
            delete_link:
                type:         url
                route:        cb_newage_reservation_api_delete_reservation_pview
                params:
                    rid: rid
                    id: id
        actions:
            delete:
                type:         delete
                acl_resource: cb_newage_reservation_delete
                label:        oro.grid.action.delete
                icon:         trash
                link:         delete_link
        filters:
            columns:

        options:
            entityHint: panel_view
            export: true
            mass_actions:
                delete:
                    enabled: false


    reservation-with-confirm-panel_view-grid:
        extends: reservation-panel_view-grid

        action_configuration: "@cb_newage.reservation.datagrid_helper->getActionConfigurationClosure"

        mass_actions:
            confirm:
                type: confirm
                entity_name: %cb_newage_panel_view.entity.class%
                data_identifier: pv.id
                label: cb.newage.reservation.datagrid.action.confirm
                icon: random


    offer-items-grid:
        source:
            type: orm
            acl_resource: cb_newage_offer_view
            query:
                select:
                    - i.id
                    - i.start
                    - i.end
                    - pv.name as panelView
                    - pv.url
                    - p.name as panel
                    - st.name as support
                    - lt.name as lighting
                    - ct.name as city
                from:
                    - { table: %cb_newage.offer_item.entity.class%, alias: i }
                join:
                    left:
                        -
                            join: i.panelView
                            alias: pv
                        -
                            join: pv.panel
                            alias: p
                        -
                            join: p.supportType
                            alias: st
                        -
                            join: p.lightingType
                            alias: lt
                        - { join: p.addresses, alias: addr, conditionType: WITH, condition: 'addr.primary = true' }
                        -
                            join: addr.city
                            alias: ct
                where:
                    and:
                        - i.offer = :offer
            bind_parameters:
                - offer

        columns:
            url:
                label:        cb.newage.panelview.url.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/photo.html.twig
            panel:
                label:        cb.newage.panel.entity_label
            panelView:
                label:        cb.newage.panelview.name.label
            start:
                label:         cb.newage.offer.start.label
                frontend_type: date
            end:
                label:         cb.newage.offer.end.label
                frontend_type: date
            support:
                label:        cb.newage.supporttype.entity_label
            lighting:
                label:        cb.newage.lightingtype.entity_label
            city:
                label:        oro.address.city.label
        sorters:
            columns:
                city:
                    data_name: ct.name
                panel:
                    data_name: p.name
                panelView:
                    data_name: pv.name
            default:
                city:       '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                panel:      '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                panelView:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        filters:
            columns:
                city:
                    type: choice-tree
                    data_name: addr.city
                    options:
                        lazy: "@cb_city.provider.filter.city_choice_tree->shouldBeLazy"
                        data: "@?cb_city.provider.filter.city_choice_tree->getList"
                    enabled: true
                support:
                    type: choice-tree
                    data_name: p.supportType
                    options:
                        lazy: "@cb_support.provider.filter.support_choice_tree->shouldBeLazy"
                        data: "@?cb_support.provider.filter.support_choice_tree->getList"
                    enabled: true
                lighting:
                    type: choice-tree
                    data_name: p.lightingType
                    options:
                        lazy: "@cb_lighting.provider.filter.lighting_choice_tree->shouldBeLazy"
                        data: "@?cb_lighting.provider.filter.lighting_choice_tree->getList"
                    enabled: true

        properties:
            id: ~
        action_configuration:
            delete: false
        options:
            entityHint: offerItem
            mass_actions:
                delete:
                    enabled: false
            routerEnabled: false

    available-panel_view-grid:
        source:
            type: orm
            acl_resource: cb_newage_panel_view_view
            query:
                select:
                    - pv.id
                    - pv.name
                    - pv.url
                    - p.name as panel
                    - p.dimensions
                    - st.name as support
                    - lt.name as lighting
                    - ct.name as city
                    - CONCAT(addr.street,  CONCAT(' ', addr.street2)) as address
                from:
                    - { table: %cb_newage_panel_view.entity.class%, alias: pv }
                join:
                    left:
                        -
                            join: pv.panel
                            alias: p
                        -
                            join: p.supportType
                            alias: st
                        -
                            join: p.lightingType
                            alias: lt
                        - { join: p.addresses, alias: addr, conditionType: WITH, condition: 'addr.primary = true' }
                        -
                            join: addr.city
                            alias: ct
                where:
                    and:
                        - pv.id NOT IN (:forbidden)
            bind_parameters:
                - forbidden

        columns:
            url:
                label:        cb.newage.panelview.url.label
                type: twig
                frontend_type: html
                template: CBNewAgeBundle:Datagrid:Property/url.html.twig
            city:
                label:        oro.address.city.label
            address:
                label:        cb.newage.panel.address.label
            panel:
                label:        cb.newage.panel.entity_label
            name:
                label:        cb.newage.panelview.name.label
            support:
                label:        cb.newage.supporttype.entity_label
            dimensions:
                label:        cb.newage.panel.dimensions.label
            lighting:
                label:        cb.newage.lightingtype.entity_label

        sorters:
            columns:
                panel:
                    data_name: p.name
                name:
                    data_name: pv.name
            default:
                panel: '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'
                name:  '%oro_datagrid.extension.orm_sorter.class%::DIRECTION_ASC'

        filters:
            columns:
                city:
                    type: choice-tree
                    data_name: addr.city
                    options:
                        lazy: "@cb_city.provider.filter.city_choice_tree->shouldBeLazy"
                        data: "@?cb_city.provider.filter.city_choice_tree->getList"
                    enabled: true
                support:
                    type: choice-tree
                    data_name: p.supportType
                    options:
                        lazy: "@cb_support.provider.filter.support_choice_tree->shouldBeLazy"
                        data: "@?cb_support.provider.filter.support_choice_tree->getList"
                    enabled: true
                lighting:
                    type: choice-tree
                    data_name: p.lightingType
                    options:
                        lazy: "@cb_lighting.provider.filter.lighting_choice_tree->shouldBeLazy"
                        data: "@?cb_lighting.provider.filter.lighting_choice_tree->getList"
                    enabled: true

        properties:
            id: ~
        action_configuration:
            delete: false
        options:
            entityHint: panelView
            mass_actions:
                delete:
                    enabled: false
#            routerEnabled: false
        mass_actions:
            offer:
                type: offer
                entity_name: %cb_newage_panel_view.entity.class%
                data_identifier: pv.id
                label: cb.newage.offer.datagrid.action.offer
                icon: random